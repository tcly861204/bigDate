!function(e){for(var t=0,a=["","webkit","moz"],s=0;s<a.length&&!e.requestAnimationFrame;++s)e.requestAnimationFrame=e[a[s]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[a[s]+"CancelAnimationFrame"]||e[a[s]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(a,s){var i=(new Date).getTime(),n=Math.max(0,16.7-(i-t)),o=e.setTimeout(function(){a(i+n)},n);return t=i+n,o}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)}),e._base={toNum:function(e){return e<10?"0"+e:e},showLoading:function(){this.loadNode=weui.loading("加载中...")},hideLoading:function(){this.loadNode.hide()},hasClass:function(e,t){return!!e.className&&new RegExp(" "+t+" ").test(" "+e.className+" ")},addClass:function(e,t,a){if(a)for(var s=e.parentNode.childNodes,i=0,n=s.length;i<n;i++)1===s[i].nodeType&&s[i]!==e&&_base.removeClass(s[i],t);this.hasClass(e,t)||(e.className=e.className+" "+t)},removeClass:function(e,t){if(this.hasClass(e,t)){var a=new RegExp(" "+t+" ");e.className=(" "+e.className+" ").replace(a,"")}},setQueryTime:function(e){var t=new Date;return 0===e?(t.setMonth(0),t.setDate(1),_base.getTimeString(t)):(t.setMonth(t.getMonth()-e),_base.getTimeString(t))},getTimeString:function(e){if(e&&"object"==typeof e){var t=[e.getFullYear(),_base.toNum(e.getMonth()+1),_base.toNum(e.getDate())];return t[0]+"-"+t[1]+"-"+t[2]}},getTimeItem:function(e,t){if(e&&e.length>=10)switch(t){case"Y":return parseInt(e.substr(0,4));case"m":return parseInt(e.substr(5,2));case"d":return parseInt(e.substr(8,2))}return""},css:function(e,t){if(t){var a="";for(var s in t)a+=s+":"+t[s]+";";e.style.cssText=a}},attr:function(e,t){return e.getAttribute(t)}},Vue.prototype.$http=axios,Vue.filter("noFace",function(e){return e||"http://cdnfile.op110.com.cn/files/1/file/20170727/face_1501143964193.jpg"}),Vue.filter("formatTime",function(e){return e?e.substring(0,10):"-"}),Vue.filter("formatNum",function(e){return 0!==e&&e?e.toFixed(2):e}),Vue.filter("absNum",function(e){return 0!==e?Math.abs(e).toFixed(2):e}),Vue.filter("saleSex",function(e){return e&&"男"==e?"icon icon-man":e&&"女"==e?"icon icon-woman":"-"}),Vue.filter("birthTime",function(e){if(e&&e.length>=10&&e.split("-").length>2){var t=e.substring(0,4),a=e.substr(5,2),s=e.substr(8,2),i=new Date,n=i.getFullYear()+"",o=_base.toNum(i.getMonth()+1)+"",r=_base.toNum(i.getDate())+"";return Math.floor((parseInt(n+o+r)-parseInt(t+a+s))/1e4)}return"-"});var i=new Vue({el:"#app",data:{SaleEnterFaceFlag:"s-show",pageTitleList:["基本信息","业绩走势","收客人数","订单利润与亏损占比","产品类别销售占比","客单价区间销量占比"],searchPanel:{dataTimes:["","","",""],operate_type:["active","",""]},searchSales:[],resetSaleAll:[],pageTitle:"基本信息",footText:"上滑查看更多",footDist:"next",nowTime:new Date,nowPageIndex:0,echartOptions:{act:{bit:10,key:[]},sal:{bit:10,key:[]}},pageTypes:{1:"yeji",2:"shouke",3:"lirun",4:"chanpin",5:"kedan"},pageLoads:{1:!1,2:!1,3:!1,4:!1,5:!1},pageDatas:{yeji:[],sum1:0,show:[],sum2:0,lirun:{loss:{saleLossAmount:0,saleLossPercentage:0},profit:{saleProfitAmount:0,saleProfitPercentage:0}},kedan:[],chanpin:[]},dataURL:{sale:"/sys/main?xwl=34580M8L8X9A",itemSale:"/sys/main?xwl=34580M8L8X9P",deepSale:"/sys/main?xwl=34580M8L8Z1I"},searchDates:{saleID:"",saleName:"",saleFace:"",deptName:"",operate_type:"",dateType:"出团日期",startdate:"",enddate:""},saleWholeFlag:"false",saleWhole:[],saleSingles:{birthday:"",deptName:"",education:"",entryData:"",head_photo:"",monthHighPerNum:"",monthHighPerNumMonth:"",perNumNoRate:"",perNumTrue:"",perNumTrueRate:"",pingAmountNo:"",saleID:"",saleName:"",sex:""}},initDate:function(){this.searchDates.startdate=_base.setQueryTime(3),this.searchDates.enddate=_base.getTimeString(this.nowTime)},getSaleFaceList:function(e,t){var a=this;void 0===e&&(e=""),_base.showLoading(),this.$http.post(this.dataURL.sale,{saleName:e}).then(function(e){_base.hideLoading(),a.resetSaleAll.length||(a.resetSaleAll=e.data.saleWhole),"first"===t&&(a.saleWholeFlag="true",a.saleWhole=e.data.saleWhole),"search"===t&&(a.searchSales=e.data.saleWhole)})},created:function(){this.$options.initDate.call(this),this.$options.getSaleFaceList.call(this,"","first")},createSwiper:function(){var e=this;new Swiper(".swiper-container",{direction:"vertical",autoHeight:!0,loop:!1,initialSlide:0,onSlideChangeEnd:function(t){switch(e.nowPageIndex=t.realIndex,e.pageTitle=e.pageTitleList[e.nowPageIndex],5===t.realIndex?(e.footText="最后一页了",e.footDist="prev"):(e.footText="上滑查看更多",e.footDist="next"),e.pageLoads[e.nowPageIndex]||e.loadPages.call(i,e.nowPageIndex),t.realIndex){case 0:break;case 1:e.achievement.call(i),setTimeout(function(){e.pageLoads[0]||e.loadPages.call(i,0),e.pageLoads[2]||e.loadPages.call(i,2)},100);break;case 2:e.saloon.call(i),setTimeout(function(){e.pageLoads[1]||e.loadPages.call(i,1),e.pageLoads[3]||e.loadPages.call(i,3)},100);break;case 3:e.profit.call(i),setTimeout(function(){e.pageLoads[2]||e.loadPages.call(i,2),e.pageLoads[4]||e.loadPages.call(i,4)},100);break;case 4:e.saleTypeBit.call(i),setTimeout(function(){e.pageLoads[3]||e.loadPages.call(i,3),e.pageLoads[5]||e.loadPages.call(i,5)},100);break;case 5:e.unitPrice.call(i)}}})},initNodes:function(){this.achievementTrendChart=echarts.init(document.getElementById("Js_achievement")),this.saloonTrendChart=echarts.init(document.getElementById("Js_saloon"))},mounted:function(){this._winfo=document.body.getBoundingClientRect(),this._ww=this._winfo.width,this._wh=this._winfo.height,this._scaleBit=4,this.$options.createSwiper.call(this),this.$options.initNodes.call(this),this.unitPriceInfos=this.$refs.Js_unitPrice_box.getBoundingClientRect()},methods:{enterFaceList:function(e){var t=e.target;if(_base.hasClass(t,"face")&&(_base.addClass(t.parentNode,"active"),this.searchDates.saleID=_base.attr(t.parentNode,"data-id"),this.searchDates.saleName=_base.attr(t.parentNode,"data-name"),this.searchDates.saleFace=_base.attr(t.parentNode,"data-face"),_base.removeClass(this.$refs.JsSaleEnterFace,"s-show"),this.loadPages(0)),_base.hasClass(t,"s-btn")){var a=this.$refs.Js_skey_face_enter.value;this.$options.getSaleFaceList.call(this,a,"first")}_base.hasClass(t,"face-fd")&&_base.removeClass(this.$refs.JsSaleEnterFace,"s-show")},showRagePanel:function(){this.searchSales=this.resetSaleAll,_base.addClass(this.$refs.Js_searchPanel,"s-show")},searchRage:function(e){var t=this,a=e.target;if(_base.hasClass(a,"dropLoadMax")&&(_base.hasClass(this.$refs.Js_faceList,"max")?(_base.removeClass(this.$refs.Js_faceList,"max"),_base.addClass(a,"max")):(_base.addClass(this.$refs.Js_faceList,"max"),_base.removeClass(a,"max"))),_base.hasClass(a,"back")&&_base.removeClass(this.$refs.Js_searchPanel,"s-show"),_base.hasClass(a,"s-start")&&weui.datePicker({start:2012,defaultValue:[_base.getTimeItem(t.searchDates.startdate,"Y"),_base.getTimeItem(t.searchDates.startdate,"m"),_base.getTimeItem(t.searchDates.startdate,"d")],end:t.searchDates.enddate,onConfirm:function(e){t.searchDates.startdate=e[0].value+"-"+_base.toNum(e[1].value)+"-"+_base.toNum(e[2].value)}}),_base.hasClass(a,"s-start")&&weui.datePicker({start:t.searchDates.startdate,defaultValue:[_base.getTimeItem(t.searchDates.enddate,"Y"),_base.getTimeItem(t.searchDates.enddate,"m"),_base.getTimeItem(t.searchDates.enddate,"d")],onConfirm:function(e){t.searchDates.enddate=e[0].value+"-"+_base.toNum(e[1].value)+"-"+_base.toNum(e[2].value)}}),_base.hasClass(a,"user-face")){var s=a.parentNode.parentNode;t.searchDates.saleID=_base.attr(s,"data-id"),t.searchDates.saleName=_base.attr(s,"data-name"),t.searchDates.saleFace=_base.attr(s,"data-face"),_base.addClass(s,"active","mutile")}if(_base.hasClass(a,"s-face-btn")){var i=this.$refs.Js_skey_face_search.value;t.$options.getSaleFaceList.call(t,i,"search")}if(_base.hasClass(a,"s-click"))if("dataTimes"===_base.attr(a.parentNode,"data-text"))t.searchDates.startdate=_base.setQueryTime(parseInt(_base.attr(a,"data-type"),10)),t.searchDates.enddate=_base.getTimeString(t.nowTime),_base.addClass(a,"active","mutile");else{var n=_base.attr(a.parentNode,"data-text");_base.addClass(a,"active","mutile"),n&&(t.searchDates[n]=_base.attr(a,"data-type"))}if(_base.hasClass(a,"btn-true")){for(var o in t.pageLoads)t.pageLoads[o]=!1;_base.removeClass(this.$refs.Js_searchPanel,"s-show"),t.loadPages(t.nowPageIndex)}},loadPages:function(e){var t=this,a=0;e===t.nowPageIndex&&_base.showLoading(),0===e?this.$http.post(this.dataURL.itemSale,this.searchDates).then(function(a){_base.hideLoading(),t.pageLoads[e]=!0,t.saleSingles=a.data.saleSingles,t.pageLoads[1]||t.loadPages(1)}):(this.searchDates.pageType=t.pageTypes[e],this.$http.post(this.dataURL.deepSale,this.searchDates).then(function(s){switch(_base.hideLoading(),t.pageLoads[e]=!0,e){case 1:t.pageDatas[t.pageTypes[e]]=s.data.saleAchievement||[],t.pageDatas[t.pageTypes[e]].forEach(function(e,t){a+=1*e.amount}),t.pageDatas.sum1=a,1===t.nowPageIndex&&t.achievement.call(t);break;case 2:t.pageDatas[t.pageTypes[e]]=s.data.salePerNumTrend||[],t.pageDatas[t.pageTypes[e]].forEach(function(e,t){a+=1*e.perNum}),t.pageDatas.sum2=a,2===t.nowPageIndex&&t.saloon.call(t);break;case 3:t.pageDatas[t.pageTypes[e]]=s.data.saleProfitLoss,3===t.nowPageIndex&&t.profit.call(t);break;case 4:s.data.saleLineTypePercentage.sort(function(e,t){return t.salePerNumPercentage-e.salePerNumPercentage}),t.pageDatas[t.pageTypes[e]]=s.data.saleLineTypePercentage,4===t.nowPageIndex&&t.saleTypeBit.call(t);break;case 5:s.data.saleUnitPriceSection.sort(function(e,t){return t.startAmount-e.startAmount}),t.pageDatas[t.pageTypes[e]]=s.data.saleUnitPriceSection,5===t.nowPageIndex&&t.unitPrice.call(t)}}))},achievConfig:function(e,t,a){return{color:["#33b4eb"],textStyle:{color:"#33b4eb"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},dataZoom:{show:!0,type:"inside",realtime:!0,start:0,end:e},grid:{show:!0,left:"10",right:"0",top:"10",bottom:"5",containLabel:!0,borderColor:"#33b4eb",borderWidth:0,shadowBlur:0},xAxis:[{type:"category",data:t,axisTick:{alignWithLabel:!0},axisLine:{lineStyle:{width:0,color:"#33b4eb"}},splitLine:{show:!0,lineStyle:{width:0,color:"#0e5f97"}}}],yAxis:[{type:"value",axisLine:{lineStyle:{color:"#33b4eb"}},splitLine:{show:!0,lineStyle:{color:"#0e5f97"}},axisLabel:{formatter:"￥{value}"}}],series:[{name:"营业额",type:"bar",barWidth:20,data:a}]}},achievement:function(){if(!this.pageLoads[1])return _base.showLoading(),!1;var e=this.pageDatas.yeji||[],t=e.length||1;t=t<10?10:t;var a=Math.floor(1e3/t),s=[],i=[];e.forEach(function(e,t){s.push(e.addTimeYearMonth),i.push(e.amount),Number(e.amount)}),s.push(""),i.push(""),this.echartOptions.act.bit=a,this.echartOptions.act.key=s,this.achievementTrendChart.setOption(this.achievConfig(a,s,i))},saloonConfig:function(e,t,a){return{color:["ffd800"],textStyle:{color:"#33b4eb"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},dataZoom:{show:!0,type:"inside",realtime:!0,start:0,end:e},grid:{show:!0,left:"10",right:"0",top:"10",bottom:"5",containLabel:!0,borderColor:"#33b4eb",borderWidth:0,shadowBlur:0},xAxis:[{type:"category",data:t,axisTick:{alignWithLabel:!0},axisLine:{lineStyle:{width:0,color:"#33b4eb"}},splitLine:{show:!0,lineStyle:{width:0,color:"#0e5f97"}}}],yAxis:[{type:"value",axisLine:{lineStyle:{color:"#33b4eb"}},splitLine:{show:!0,lineStyle:{color:"#0e5f97"}},axisLabel:{formatter:"{value}人"}}],series:[{name:"收 客",type:"line",smooth:!0,lineStyle:{normal:{color:"#ffd800",width:3,shadowColor:"rgba(0,0,0,0.4)",shadowBlur:10,shadowOffsetY:10}},itemStyle:{normal:{color:"#ffd800",width:3,shadowColor:"rgba(0,0,0,0.4)",shadowBlur:10,shadowOffsetY:10}},data:a}]}},saloon:function(){if(!this.pageLoads[2])return _base.showLoading(),!1;var e=this.pageDatas.shouke||[],t=1e3/((e.length||1)<10?10:e.length),a=[],s=[];e.forEach(function(e,t){a.push(e.addTimeYearMonth),s.push(e.perNum)}),a.push(""),s.push(""),this.echartOptions.sal.bit=t,this.echartOptions.sal.key=a,this.saloonTrendChart.setOption(this.saloonConfig(t,a,s))},profit:function(){if(!this.pageLoads[3])return _base.showLoading(),!1;var t=this.pageDatas.lirun,a=[{ctx:this.$refs.Js_prefit_ctx.getContext("2d"),color:"#3bccff",bit:Number(t.profit.saleProfitPercentage||0),iNum:0,deg:0,timer:0,amount:t.profit.saleProfitAmount},{ctx:this.$refs.Js_loss_ctx.getContext("2d"),color:"#715eff",bit:Number(t.loss.saleLossPercentage||0),iNum:0,deg:0,timer:0,amount:t.loss.saleLossAmount}],s=this.$refs.Js_prefit_box.getBoundingClientRect(),i=Math.floor(s.height);this.$refs.Js_prefit_ctx.width=4*i,this.$refs.Js_prefit_ctx.height=4*i,this.$refs.Js_loss_ctx.width=4*i,this.$refs.Js_loss_ctx.height=4*i;var n=2*i,o=80;a.forEach(function(t,a){!function a(){if(t.ctx.clearRect(0,0,4*i,4*i),t.ctx.beginPath(),t.ctx.lineWidth=o,t.ctx.strokeStyle="#0e3c6c",t.ctx.arc(n,n,n-o/2,0,2*Math.PI),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.strokeStyle=t.color,t.deg=(t.iNum-25)/50*Math.PI,t.ctx.arc(n,n,n-o/2,-.5*Math.PI,t.deg),t.ctx.stroke(),t.iNum+=2,t.iNum>t.bit)return e.cancelAnimationFrame(t.timer),!1;t.timer=e.requestAnimationFrame(a)}()})},salePropCvs:function(t,a,s){var i=document.querySelector("#Js_saleType_"+t);i.width=parseInt(i.width)*this._scaleBit,i.height=parseInt(i.height)*this._scaleBit;var n=i.parentNode.childNodes[3],o=i.getContext("2d"),r=0,l=i.width,c=14*this._scaleBit;o.Num=0,o.timer=null,function t(){0===a&&(o.beginPath(),o.lineWidth=c,o.strokeStyle="#17305a",o.arc(l/2,l/2,l/2-c/2,0,2*Math.PI),o.stroke(),o.fillStyle=s,o.textBaseline="middle",o.font="bold 2.8rem Arial",o.textAlign="center",n.innerHTML='0<span class="bit">%</span>',o.fillText(0,l/2,l/2)),o.clearRect(0,0,i.width,i.height),o.beginPath(),o.lineWidth=c,o.strokeStyle="#17305a",o.arc(l/2,l/2,l/2-c/2,0,2*Math.PI),o.stroke(),o.beginPath(),o.strokeStyle=s,a-o.Num>0&&a-o.Num<=2?(r=(a-25)/50*Math.PI,n.innerHTML=a+'<span class="bit">%</span>'):(r=(o.Num-25)/50*Math.PI,n.innerHTML=o.Num+'<span class="bit">%</span>'),o.arc(l/2,l/2,l/2-c/2,-.5*Math.PI,r),o.stroke(),a-o.Num>0&&a-o.Num<=2?e.cancelAnimationFrame(o.timer):(o.Num+=2,o.timer=e.requestAnimationFrame(t))}()},saleTypeTpl:function(e,t,a,s){return'<dl class="cvs-item" style="width: '+t+"px;margin-right:"+a+'px;">\n                    <dt class="cvs-cnt" style="width:'+t+"px;height: "+t+'px;">\n                        <canvas style="zoom:0.25;" class="cxt" id="Js_saleType_'+s+'" width="'+t+'" height="'+t+'"></canvas>\n                        <p class="ctx-num"></p>\n                    </dt>\n                    <dd class="typeName eps">'+(e.lineTypeName||"-")+'</dd>\n                    <dd class="num eps">收客'+e.salePerNum+'人</dd>\n                    <dd class="no eps">团队NO.'+(e.saleRanking+1)+"</dd>\n                </dl>"},saleTypeBit:function(){if(!this.pageLoads[4])return _base.showLoading(),!1;var e=this,t=this.pageDatas.chanpin||[],a=t.length,s=0,i=0;a>6?(_base.removeClass(this.$refs.Js_saleTypeBit_list,"min"),_base.css(this.$refs.Js_saleTypeBit_list,{width:.38*this._ww*Math.ceil(a/2)+"px","padding-left":.025*this._ww+"px"}),i=.3*this._ww,s=.08*this._ww):(_base.addClass(this.$refs.Js_saleTypeBit_list,"min min-"+a),_base.css(this.$refs.Js_saleTypeBit_list,{width:.325*this._ww*Math.ceil(a/2)-.025*this._ww+"px"}),i=.3*this._ww,s=.025*this._ww);var n="";t.forEach(function(t,a){n+=e.saleTypeTpl(t,i,s,a)}),this.$refs.Js_saleTypeBit_list.innerHTML=n;var o=0,r=setInterval(function(){o>=a?clearInterval(r):(e.salePropCvs(o,Number(t[o].salePerNumPercentage),"#725cff"),o++)},100)},unitPrice:function(){if(!this.pageLoads[5])return _base.showLoading(),!1;var t=this.pageDatas.kedan||[],a=this.unitPriceInfos.height,s=[this._scaleBit,t.length,50],i=s[0],n=s[1],o=s[2];n=Math.floor(a/o)>n?n:Math.floor(a/o);var r=this.$refs.Js_unitPrice;r.width=this._ww*i,r.height=n*o*i;for(var l=r.getContext("2d"),c=15*i,h=25*i,d=o*i,u=r.width-30*i,f=0,m=0,p=null,g=0,b=0;b<n;b++)0===b&&(t[b].text=t[b].startAmount+"以上",g+=100*t[b].saleUnitPriceSection),b>0&&b<n-1&&(t[b].text=t[b].startAmount+"-"+t[b].endAmount,g+=100*t[b].saleUnitPriceSection),b===n-1&&(t[b].saleUnitPriceSection=(1e4-g)/100,t[b].text=t[b].endAmount+"以下"),1*t[b].saleUnitPriceSection>f&&(f=1*t[b].saleUnitPriceSection);var _=l.createLinearGradient(c,0,c+u*f/100,0);_.addColorStop(0,"#5943ff"),_.addColorStop(1,"#ed69c7"),function a(){l.clearRect(0,0,r.width,r.height);for(var s=0;s<n;s++)l.fillStyle="#17305a",l.fillRect(c,h+s*d,u,h),l.fillStyle="#3bccff",l.textBaseline="bottom",l.font=13*i+"px Arial",l.textAlign="start",l.fillText(t[s].text,c,h+s*d),l.fillStyle="#44f8ff",l.textAlign="end",1*t[s].saleUnitPriceSection>m?(l.fillText(m+"%",r.width-c,h+s*d),l.fillStyle=_,l.fillRect(c,h+s*d,u*m/100,h)):(l.fillText(Number(t[s].saleUnitPriceSection).toFixed(2)+"%",r.width-c,h+s*d),l.fillStyle=_,l.fillRect(c,h+s*d,u*t[s].saleUnitPriceSection/100,h));if(m-f>0&&m-f<=1)return e.cancelAnimationFrame(p),!1;m++,p=e.requestAnimationFrame(a)}()}}})}(window);